<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Pairing Interface</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Create basic button component to replace shadcn
        const Button = React.forwardRef(({ className = "", variant = "default", size = "default", children, ...props }, ref) => {
            const baseStyles = "inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50";
            const variants = {
                default: "bg-primary text-primary-foreground shadow hover:bg-primary/90",
                outline: "border border-input bg-white hover:bg-accent hover:text-accent-foreground",
            };
            const sizes = {
                default: "h-9 px-4 py-2",
                sm: "h-8 rounded-md px-3 text-xs",
            };
            
            return (
                <button
                    className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}
                    ref={ref}
                    {...props}
                >
                    {children}
                </button>
            );
        });

        // Get icons from Lucide
        const { ImagePlus, RotateCw, RotateCcw, FlipHorizontal } = lucide;

        const TilePairingInterface = () => {
            const [tiles, setTiles] = React.useState([]);
            const [isFlipped, setIsFlipped] = React.useState(false);
            const [draggedTile, setDraggedTile] = React.useState(null);
            const [dragOffset, setDragOffset] = React.useState({ x: 0, y: 0 });

            const tilePath = "M93.075588,186.263531L94.568682,74.654722l63.456514-.373275L190.5,19.036953L286.058044,73.5349l-.373274,110.488989l63.829788.746547L381,240.761477l-95.688503,54.497947L190.5,240.761476l-31.728257,54.124673-129.152669-.000001L0,240.761476l93.075588-54.497945Z";

            const centerX = 190.5;
            const centerY = 147.5;

            const addTilePair = () => {
                setTiles([...tiles, {
                    id: Date.now(),
                    front: null,
                    back: null,
                    x: Math.random() * 800,
                    y: Math.random() * 600,
                    rotation: 0,
                    isMirrored: false
                }]);
            };

            const rotateTile = (tileId, direction) => {
                setTiles(tiles.map(tile => 
                    tile.id === tileId
                        ? { ...tile, rotation: tile.rotation + (direction * 15) }
                        : tile
                ));
            };

            const mirrorTile = (tileId) => {
                setTiles(tiles.map(tile => 
                    tile.id === tileId
                        ? { ...tile, isMirrored: !tile.isMirrored }
                        : tile
                ));
            };

            const handleDragStart = (e, tile) => {
                const svgElement = e.target.closest('svg');
                const pt = svgElement.createSVGPoint();
                pt.x = e.clientX;
                pt.y = e.clientY;
                const svgP = pt.matrixTransform(svgElement.getScreenCTM().inverse());
                
                setDraggedTile(tile);
                setDragOffset({
                    x: svgP.x - tile.x,
                    y: svgP.y - tile.y
                });
            };

            const handleDrag = (e) => {
                if (!draggedTile) return;

                const svgElement = e.target.closest('svg');
                const pt = svgElement.createSVGPoint();
                pt.x = e.clientX;
                pt.y = e.clientY;
                const svgP = pt.matrixTransform(svgElement.getScreenCTM().inverse());

                setTiles(tiles.map(tile => 
                    tile.id === draggedTile.id
                        ? { ...tile, x: svgP.x - dragOffset.x, y: svgP.y - dragOffset.y }
                        : tile
                ));
            };

            const handleDragEnd = () => {
                setDraggedTile(null);
            };

            const handleImageSelect = (e, tileId, side) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setTiles(tiles.map(tile =>
                            tile.id === tileId
                                ? { ...tile, [side]: e.target.result }
                                : tile
                        ));
                    };
                    reader.readAsDataURL(file);
                }
            };

            const getTileTransform = (tile) => {
                return `
                    translate(${tile.x + centerX}, ${tile.y + centerY})
                    rotate(${tile.rotation})
                    scale(${(tile.isMirrored ? -1 : 1) * (isFlipped ? -1 : 1)}, 1)
                    translate(${-centerX}, ${-centerY})
                `;
            };

            return (
                <div className="w-full h-screen flex flex-col">
                    <div className="flex justify-between p-4">
                        <Button 
                            onClick={addTilePair}
                            className="flex items-center gap-2"
                            variant="outline"
                        >
                            <ImagePlus className="w-4 h-4" />
                            Add Tile
                        </Button>
                        <Button 
                            onClick={() => setIsFlipped(!isFlipped)}
                            className="flex items-center gap-2"
                            variant="outline"
                        >
                            <RotateCcw className="w-4 h-4" />
                            Flip All
                        </Button>
                    </div>

                    <svg 
                        className="flex-1 w-full bg-gray-50"
                        onMouseMove={handleDrag}
                        onMouseUp={handleDragEnd}
                        onMouseLeave={handleDragEnd}
                        viewBox="0 0 1200 800"
                        preserveAspectRatio="xMidYMid meet"
                    >
                        <defs>
                            {tiles.map((tile) => (
                                <React.Fragment key={`patterns-${tile.id}`}>
                                    <pattern
                                        id={`front-${tile.id}`}
                                        patternUnits="userSpaceOnUse"
                                        width="381"
                                        height="295"
                                        patternTransform={`scale(${(tile.isMirrored ? -1 : 1) * (isFlipped ? -1 : 1)}, 1)`}
                                    >
                                        {tile.front ? (
                                            <image
                                                href={tile.front}
                                                width="381"
                                                height="295"
                                                preserveAspectRatio="xMidYMid slice"
                                            />
                                        ) : (
                                            <rect width="381" height="295" fill="#f0f0f0" />
                                        )}
                                    </pattern>
                                    <pattern
                                        id={`back-${tile.id}`}
                                        patternUnits="userSpaceOnUse"
                                        width="381"
                                        height="295"
                                        patternTransform={`scale(${(tile.isMirrored ? -1 : 1) * (isFlipped ? -1 : 1)}, 1)`}
                                    >
                                        {tile.back ? (
                                            <image
                                                href={tile.back}
                                                width="381"
                                                height="295"
                                                preserveAspectRatio="xMidYMid slice"
                                            />
                                        ) : (
                                            <rect width="381" height="295" fill="#e0e0e0" />
                                        )}
                                    </pattern>
                                </React.Fragment>
                            ))}
                        </defs>

                        {tiles.map((tile) => (
                            <g
                                key={tile.id}
                                transform={getTileTransform(tile)}
                                onMouseDown={(e) => handleDragStart(e, tile)}
                                style={{ cursor: 'move' }}
                            >
                                <path
                                    d={tilePath}
                                    fill={`url(#${isFlipped ? 'back' : 'front'}-${tile.id})`}
                                    stroke="black"
                                    strokeWidth="1"
                                />
                                {!tile[isFlipped ? 'back' : 'front'] && (
                                    <foreignObject x="140" y="120" width="100" height="40">
                                        <div className="flex justify-center">
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => handleImageSelect(e, tile.id, isFlipped ? 'back' : 'front')}
                                                className="w-full h-full opacity-0 cursor-pointer absolute"
                                            />
                                            <span className="text-gray-500 text-sm">
                                                {isFlipped ? 'Add Back' : 'Add Front'}
                                            </span>
                                        </div>
                                    </foreignObject>
                                )}
                                <foreignObject x="100" y="240" width="180" height="40">
                                    <div className="flex justify-center gap-2">
                                        <Button 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                rotateTile(tile.id, -1);
                                            }}
                                            size="sm"
                                            variant="outline"
                                            className="bg-white"
                                        >
                                            <RotateCcw className="w-4 h-4" />
                                        </Button>
                                        <Button 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                rotateTile(tile.id, 1);
                                            }}
                                            size="sm"
                                            variant="outline"
                                            className="bg-white"
                                        >
                                            <RotateCw className="w-4 h-4" />
                                        </Button>
                                        <Button 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                mirrorTile(tile.id);
                                            }}
                                            size="sm"
                                            variant="outline"
                                            className="bg-white"
                                        >
                                            <FlipHorizontal className="w-4 h-4" />
                                        </Button>
                                    </div>
                                </foreignObject>
                            </g>
                        ))}
                    </svg>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TilePairingInterface />);
    </script>
</body>
</html>
